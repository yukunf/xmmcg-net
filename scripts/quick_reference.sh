#!/bin/bash
# ================================================================
# XMMCG Phase Update - å¿«é€Ÿå‚è€ƒ
# ================================================================

cat << 'EOF'
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘         XMMCG Phase Status Update - å¿«é€Ÿå‚è€ƒ                  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ é¡¹ç›®è·¯å¾„: /var/www/xmmcg-net

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš™ï¸  ä¸€é”®éƒ¨ç½²
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
sudo /var/www/xmmcg-net/scripts/deploy_phase_update.sh

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ”§ æ‰‹åŠ¨æ“ä½œ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# è®¾ç½®æ—¶åŒº
sudo timedatectl set-timezone Asia/Shanghai

# æµ‹è¯•å‘½ä»¤ï¼ˆå¹²è¿è¡Œï¼‰
cd /var/www/xmmcg-net/backend/xmmcg
source ../../.venv/bin/activate
python manage.py update_phase_status --dry-run

# æ‰§è¡Œæ›´æ–°
/var/www/xmmcg-net/scripts/update_phase_linux.sh

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â° Crontab é…ç½®
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# ç¼–è¾‘ crontab
crontab -e

# æ™ºèƒ½é¢‘ç‡ï¼ˆæ¨èï¼‰
*/10 * * * * /var/www/xmmcg-net/scripts/smart_update_phase.sh

# å›ºå®šé¢‘ç‡ï¼ˆæ¯å°æ—¶ï¼‰
0 * * * * /var/www/xmmcg-net/scripts/update_phase_linux.sh

# æŸ¥çœ‹å½“å‰é…ç½®
crontab -l

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š ç›‘æ§å’Œæ—¥å¿—
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# æŸ¥çœ‹æ›´æ–°æ—¥å¿—
tail -f /var/www/xmmcg-net/logs/phase_update.log

# æŸ¥çœ‹æ™ºèƒ½è„šæœ¬æ—¥å¿—
tail -f /var/www/xmmcg-net/logs/smart_update.log

# æŸ¥çœ‹ Cron ç³»ç»Ÿæ—¥å¿—
sudo tail -f /var/log/syslog | grep CRON

# æŸ¥çœ‹ Systemd æ—¥å¿—ï¼ˆå¦‚ä½¿ç”¨ systemdï¼‰
sudo journalctl -u xmmcg-phase-update.service -f

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ” éªŒè¯
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# æ£€æŸ¥ç³»ç»Ÿæ—¶åŒº
timedatectl

# æ£€æŸ¥ Django æ—¶åŒº
cd /var/www/xmmcg-net/backend/xmmcg
source ../../.venv/bin/activate
python manage.py shell -c "from django.conf import settings; print(settings.TIME_ZONE)"

# æŸ¥çœ‹å½“å‰é˜¶æ®µçŠ¶æ€
python manage.py shell << 'PYEOF'
from songs.models import CompetitionPhase
for p in CompetitionPhase.objects.all():
    print(f"{p.name}: is_active={p.is_active}, status={p.status}")
PYEOF

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ› ï¸  æ•…éšœæ’æŸ¥
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# Cron æœåŠ¡çŠ¶æ€
sudo systemctl status cron

# é‡å¯ Cron æœåŠ¡
sudo systemctl restart cron

# æ£€æŸ¥è„šæœ¬æƒé™
ls -lh /var/www/xmmcg-net/scripts/*.sh

# æ‰‹åŠ¨è¿è¡Œè„šæœ¬æŸ¥çœ‹é”™è¯¯
bash -x /var/www/xmmcg-net/scripts/update_phase_linux.sh

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“š æ–‡æ¡£
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
å®Œæ•´éƒ¨ç½²æŒ‡å—: DEPLOYMENT_GUIDE_DEBIAN.md
éƒ¨ç½²æ€»ç»“:     LINUX_DEPLOYMENT_SUMMARY.md
Systemd æŒ‡å—: scripts/systemd/README.md

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ¯ æ‰§è¡Œé¢‘ç‡è¯´æ˜
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ™ºèƒ½æ¨¡å¼:
  â€¢ å¹³æ—¶: æ¯å°æ—¶ 1 æ¬¡ï¼ˆæ•´ç‚¹ï¼‰
  â€¢ é˜¶æ®µåˆ‡æ¢å‰ 2 å°æ—¶: æ¯ 10 åˆ†é’Ÿ 1 æ¬¡
  â€¢ è‡ªåŠ¨è°ƒæ•´ï¼Œæ— éœ€äººå·¥å¹²é¢„

å›ºå®šæ¨¡å¼:
  â€¢ æ¯å°æ—¶æ•´ç‚¹æ‰§è¡Œ 1 æ¬¡
  â€¢ ç®€å•å¯é ï¼Œé€‚åˆå°å‹é¡¹ç›®

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

éœ€è¦å¸®åŠ©ï¼Ÿè¯·æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£æˆ–è”ç³»ç®¡ç†å‘˜ã€‚

EOF
