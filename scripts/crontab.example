# ================================================================
# XMMCG Phase Status Auto-Update - Crontab 配置
# Linux/Debian 生产环境定时任务
# ================================================================

# 编辑说明：
# 1. 编辑 crontab: crontab -e
# 2. 粘贴以下内容（根据实际路径修改）
# 3. 保存退出
# 4. 验证：crontab -l

# ================================================================
# 方案 A：固定频率（推荐用于简单场景）
# ================================================================

# 每小时整点执行一次
0 * * * * /opt/xmmcg/scripts/update_phase_linux.sh

# 或者：每 30 分钟执行一次（更及时）
# 0,30 * * * * /opt/xmmcg/scripts/update_phase_linux.sh


# ================================================================
# 方案 B：智能频率调整（推荐用于生产环境）
# ================================================================

# 每 10 分钟检查一次是否需要执行
# 平时：只在整点执行（每小时 1 次）
# 阶段切换前 2 小时：每 10 分钟执行 1 次
*/10 * * * * /opt/xmmcg/scripts/smart_update_phase.sh


# ================================================================
# 方案 C：组合式频率（精细控制）
# ================================================================

# 平时：每小时整点执行
# 0 * * * * /opt/xmmcg/scripts/update_phase_linux.sh

# 关键时段加密执行（例如：每天 8:00-22:00，每 30 分钟）
# 0,30 8-22 * * * /opt/xmmcg/scripts/update_phase_linux.sh

# 深夜低频（每 2 小时）
# 0 0,2,4,6 * * * /opt/xmmcg/scripts/update_phase_linux.sh


# ================================================================
# 日志轮转配置（可选，防止日志过大）
# ================================================================

# 每周日凌晨 3 点清理旧日志（保留最近 100 行）
# 0 3 * * 0 tail -n 100 /var/log/xmmcg/phase_update.log > /tmp/phase_update.log.tmp && mv /tmp/phase_update.log.tmp /var/log/xmmcg/phase_update.log


# ================================================================
# 时区说明
# ================================================================
# Cron 使用系统本地时间
# 确保系统时区与 Django TIME_ZONE 一致：
#   sudo timedatectl set-timezone Asia/Shanghai
#   timedatectl  # 验证时区


# ================================================================
# 监控和告警（可选）
# ================================================================

# 每天发送执行报告（需要配置邮件服务）
# 0 9 * * * grep "$(date +\%Y-\%m-\%d)" /var/log/xmmcg/phase_update.log | mail -s "XMMCG Phase Update Report" admin@example.com
